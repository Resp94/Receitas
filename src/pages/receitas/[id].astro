---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const recipeEntries = await getCollection('receitas');
  return recipeEntries.map(entry => ({
    params: { id: entry.id }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const { titulo, descricao, imagem, tempo_preparo, porcoes, categoria } = entry.data;
---

<Layout title={titulo} description={descricao}>
  <!-- Cabeçalho da Receita com a imagem em destaque -->
  <div class="recipe-hero">
    <div class="container hero-content">
      <div class="hero-image-wrapper">
        <img src={imagem} alt={titulo} class="hero-image" />
        <div class="hero-overlay"></div>
      </div>
      
      <div class="hero-text-card">
        <div style="margin-bottom: 1rem;">
          <span class={`badge badge-${categoria.toLowerCase()}`}>{categoria}</span>
        </div>
        <h1 class="recipe-title">{titulo}</h1>
        <p class="recipe-desc">{descricao}</p>
        
        <div class="recipe-info">
          <div class="info-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <div>
              <span class="info-label">TEMPO</span>
              <span class="info-value">{tempo_preparo}</span>
            </div>
          </div>
          <div class="info-divider"></div>
          <div class="info-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            <div>
              <span class="info-label">RENDIMENTO</span>
              <span class="info-value">{porcoes}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Conteúdo da Receita (Renderizado do Markdown) -->
  <div class="recipe-content-wrapper container">
    <article class="markdown-content">
      <Content />
    </article>
  </div>
</Layout>

<style>
  /* Header da receita com a imagem hero */
  .recipe-hero {
    position: relative;
    width: 100%;
    margin-bottom: 4rem;
  }
  
  .hero-content {
    position: relative;
    max-width: 1000px;
    margin: 0 auto;
    padding-top: 2rem;
  }
  
  .hero-image-wrapper {
    position: relative;
    width: 100%;
    height: 400px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
  }
  
  .hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .hero-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0) 50%, rgba(0,0,0,0.6));
  }
  
  /* Cartão branco com os títulos da receita (flutuante sobre a imagem nas telas grandes) */
  .hero-text-card {
    background: #fff;
    padding: 2.5rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    max-width: 80%;
    margin: -100px auto 0;
    position: relative;
    z-index: 10;
    text-align: center;
  }

  .recipe-title {
    font-size: 2.5rem;
    color: var(--color-secondary);
    margin-bottom: 1rem;
  }

  .recipe-desc {
    font-size: 1.125rem;
    color: #555;
    margin-bottom: 2rem;
  }

  .recipe-info {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #eee;
  }

  .info-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    text-align: left;
    color: var(--color-primary);
  }

  .info-divider {
    width: 1px;
    height: 40px;
    background-color: #e0e0e0;
  }

  .info-label {
    display: block;
    font-size: 0.75rem;
    font-weight: 700;
    color: #888;
    letter-spacing: 1px;
  }

  .info-value {
    display: block;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-text-body);
  }

  /* Estilos do conteúdo Markdown gerado (Ingredientes e Modo de Preparo) */
  .recipe-content-wrapper {
    max-width: 800px;
    margin: 0 auto 6rem;
  }

  .markdown-content :global(h2) {
    font-size: 1.75rem;
    color: var(--color-secondary);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #f0f0f0;
  }

  .markdown-content :global(ul),
  .markdown-content :global(ol) {
    margin-bottom: 2rem;
    padding-left: 1.5rem;
  }

  .markdown-content :global(li) {
    margin-bottom: 0.75rem;
    line-height: 1.8;
  }

  .markdown-content :global(ul li::marker) {
    color: var(--color-primary);
  }
  
  .markdown-content :global(strong) {
    color: var(--color-secondary);
  }

  @media (max-width: 768px) {
    .hero-image-wrapper { border-radius: 0; height: 300px; }
    .hero-content { padding-top: 0; }
    .hero-text-card { max-width: 90%; padding: 1.5rem; }
    .recipe-title { font-size: 2rem; }
    .recipe-info { flex-direction: column; gap: 1rem; }
    .info-divider { display: none; }
  }
</style>
